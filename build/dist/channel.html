<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Channel Analysis - Agent52</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2XYDFH3HWE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-2XYDFH3HWE');
  </script>
</head>
<body>
  <header class="border-bottom mb-3">
    <div class="container-fluid container-md d-flex align-items-center justify-content-between py-2">
      <a href="/" class="d-flex align-items-center text-decoration-none">
        <!--<img src="logo.png" alt="Logo" height="40" class="me-2">-->
        <span class="fs-5 fw-bold">Agent52</span>
      </a>
      <nav>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/channel.html">Analyze channel</a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main content -->
  <main class="container-fluid container-md">
    <div class="container py-5">
    <h1 class="mb-4">YouTube Channel Analysis</h1>

    <div class="mb-3">
        <label for="channelInput" class="form-label">Channel URL:</label>
        <input type="text" class="form-control" id="channelInput" placeholder="https://www.youtube.com/@robarnold22">
    </div>

    <button class="btn btn-primary mb-4" id="analyzeBtn">Analyze Channel</button>

    <div id="result" class="mt-3"></div>
</div>
  </main>

  <!-- Footer -->
  <footer class="border-top py-3 mt-4">
    <div class="container d-flex justify-content-between align-items-center small text-muted">
      <div>
        Agent52 &copy; 2025
      </div>
      <div class="d-flex align-items-center gap-2">
        <!-- Facebook SVG -->
        <a href="https://www.facebook.com/profile.php?id=61584214284643" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" style="width:24px; height:24px;">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
            <circle cx="12" cy="12" r="12" fill="#1877F2"/>
            <path d="M15.12 12.07h-2.12v7h-3v-7H8V9.57h2v-1.5c0-1.72 1.05-2.63 2.57-2.63h1.5v2.63h-1c-.48 0-.57.23-.57.57v1.43h2.14l-.28 2.5z" fill="#fff"/>
          </svg>
        </a>
  
        <!-- Email SVG -->
        <a href="mailto:blogphp.biz@gmail.com" data-bs-toggle="tooltip" data-bs-placement="top" title="blogphp.biz@gmail.com" style="width:24px; height:24px;cursor:none;">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
            <!-- Circle background -->
            <circle cx="12" cy="12" r="12" fill="#ffffff"/>
          
            <!-- Gmail logo scaled to fit the 24x24 circle -->
            <g transform="translate(-5 -2) scale(0.18)">
              <path fill="#4285f4" d="M58 108h14V74L52 59v43c0 3.32 2.69 6 6 6"/>
              <path fill="#34a853" d="M120 108h14c3.32 0 6-2.69 6-6V59l-20 15"/>
              <path fill="#fbbc04" d="M120 48v26l20-15v-8c0-7.42-8.47-11.65-14.4-7.2"/>
              <path fill="#ea4335" d="M72 74V48l24 18 24-18v26L96 92"/>
              <path fill="#c5221f" d="M52 51v8l20 15V48l-5.6-4.2c-5.94-4.45-14.4-.22-14.4 7.2"/>
            </g>
          </svg>
        </a>
      </div>
    </div>
  </footer>
  <script src="/assets/utils.js"></script>
  <script src="/assets/curl.js"></script>
  <script>
function analyzeChannelData(data) {
    let totalVideos = 0, totalViews = 0, totalDuration = 0;
    const playlists = [];
    const videosList = [];

    if (data.entries && data.entries.length) {
        data.entries.forEach(pl => {
            let playlistCount = 0;
            if (pl.entries && pl.entries.length) {
                pl.entries.forEach(video => {
                    if (video._type === "url") {
                        totalVideos++;
                        totalViews += video.view_count || 0;
                        totalDuration += video.duration || 0;
                        videosList.push(video);
                        playlistCount++;
                    }
                });
            }
            playlists.push({title: pl.title || "Unnamed Playlist", videos: playlistCount});
        });
    }

    videosList.sort((a,b) => (b.view_count || 0) - (a.view_count || 0));
    const topVideos = videosList.slice(0,3);

    const avgViews = totalVideos ? Math.round(totalViews/totalVideos) : 0;
    const avgDuration = totalVideos ? Math.round(totalDuration/totalVideos) : 0;

    return { totalVideos, totalViews, avgViews, avgDuration, playlists, topVideos };
}

document.getElementById("analyzeBtn").addEventListener("click", async () => {
    const channelUrl = document.getElementById("channelInput").value.trim();
    if (!channelUrl) {
        alert("Please enter a channel URL.");
        return;
    }
    loading();

    const payload = { action: "yt-channel", channel: channelUrl };

    try {
        const data = await CUrl.connect("POST", "https://agent52-534394830199.asia-southeast1.run.app/", payload);
        const analysis = analyzeChannelData(data);
        const container = document.getElementById("result");
        container.innerHTML = "";

        // Basic info card
        const basicCard = document.createElement("div");
        basicCard.className = "card p-4 mb-4";
        basicCard.innerHTML = `
            <h3><a href="${data.webpage_url}" target="_blank">${data.title || data.channel}</a></h3>
            <p><strong>Uploader:</strong> ${data.uploader || "N/A"}</p>
            <p><strong>Followers:</strong> ${formatNumber(data.channel_follower_count)}</p>
            <p><strong>Playlists:</strong> ${formatNumber(data.playlist_count || 0)}</p>
            <p><strong>Tags:</strong> ${data.tags && data.tags.length ? data.tags.join(", ") : "None"}</p>
        `;
        container.appendChild(basicCard);

        // Summary info card
        const summaryCard = document.createElement("div");
        summaryCard.className = "card p-4 mb-4";
        summaryCard.innerHTML = `
            <h4>Channel Summary</h4>
            <p><strong>Total Videos:</strong> ${formatNumber(analysis.totalVideos)}</p>
            <p><strong>Total Views:</strong> ${formatNumber(analysis.totalViews)}</p>
            <p><strong>Average Views per Video:</strong> ${formatNumber(analysis.avgViews)}</p>
            <p><strong>Average Duration:</strong> ${formatDuration(analysis.avgDuration)}</p>
        `;
        container.appendChild(summaryCard);

        // Top 3 videos
        if (analysis.topVideos.length) {
            const topCard = document.createElement("div");
            topCard.className = "card p-4 mb-4";
            topCard.innerHTML = `<h4>Top 3 Videos by Views</h4>`;
            analysis.topVideos.forEach(v => {
                const videoDiv = document.createElement("div");
                videoDiv.className = "d-flex align-items-start mb-3";

                // Thumbnail
                const thumb = document.createElement("img");
                thumb.src = v.thumbnails?.[0]?.url || "";
                thumb.className = "me-3";
                thumb.style.width = "120px";
                thumb.style.height = "auto";

                // Video info
                const infoDiv = document.createElement("div");
                infoDiv.innerHTML = `
                    <a href="${v.url}" target="_blank"><strong>${v.title}</strong></a>
                    <p>Views: ${formatNumber(v.view_count)} | Duration: ${formatDuration(v.duration)}</p>
                `;

                videoDiv.appendChild(thumb);
                videoDiv.appendChild(infoDiv);
                topCard.appendChild(videoDiv);
            });
            container.appendChild(topCard);
        }

        // Playlist breakdown
        if (analysis.playlists.length) {
            const plCard = document.createElement("div");
            plCard.className = "card p-4 mb-4";
            plCard.innerHTML = `<h4>Playlists</h4><ul class="list-group list-group-flush">`;
            analysis.playlists.forEach(pl => {
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.textContent = `${pl.title} â€” ${formatNumber(pl.videos)} videos`;
                plCard.querySelector("ul").appendChild(li);
            });
            container.appendChild(plCard);
        }

    } catch (err) {
        document.getElementById("result").textContent = "Error: " + err;
    } finally {
        loading('end');
    }
});
</script>
</body>
</html>