<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<title>HTML URL Extractor</title>
<style>
  body { background:#111; color:#eee; }
  #output img { border:1px solid #333; border-radius:4px; background:#000; margin-bottom:10px; }
</style>
</head>
<body class="p-4">

<div class="mb-3">
  <div class="form-check form-check-inline">
    <input class="form-check-input" type="radio" name="mode" value="image" id="modeImage" checked>
    <label class="form-check-label" for="modeImage">Image</label>
  </div>
  <div class="form-check form-check-inline">
    <input class="form-check-input" type="radio" name="mode" value="text" id="modeText">
    <label class="form-check-label" for="modeText">Text</label>
  </div>
</div>

<div class="mb-3">
  <input type="text" class="form-control" id="urlInput" placeholder="Optional: Enter URL to fetch HTML">
  <div class="form-check mt-2">
    <input class="form-check-input" type="checkbox" id="useProxy">
    <label class="form-check-label" for="useProxy">Use CORS proxy</label>
  </div>
</div>

<div class="mb-3">
  <textarea class="form-control" id="htmlInput" rows="6" placeholder="Or paste HTML here"></textarea>
</div>

<button class="btn btn-primary mb-3" id="runBtn">Run</button>

<div id="output"></div>

<script>
const output = document.getElementById('output');
const runBtn = document.getElementById('runBtn');

function extractUrlsFromHtml(html) {
  return [...html.matchAll(/(?:src|href)="([^"]+)"/g)].map(m => m[1]);
}

function displayResults(all) {
  const mode = document.querySelector('input[name="mode"]:checked').value;
  if (!all.length) { output.innerHTML = '<div class="text-warning">No URLs found</div>'; return; }

  if (mode === 'image') {
    output.innerHTML = `<div class="d-flex flex-wrap gap-2">${all.map(s => `<img src="${s}" class="img-fluid" style="max-width:200px" onerror="this.style.display='none'">`).join('')}</div>`;
    document.querySelectorAll('#output img').forEach(img => {
      img.onload = () => { if(img.naturalWidth < 100 || img.naturalHeight < 100) img.style.display = 'none'; };
    });
  } else {
    output.innerHTML = `<pre class="text-break">${all.join('\n')}</pre>`;
  }
}

async function runManualHtml() {
  const manual = document.getElementById('htmlInput').value.trim();
  if (!manual) { output.innerHTML = '<div class="text-warning">Paste HTML in the textarea!</div>'; return; }
  const urls = extractUrlsFromHtml(manual);
  displayResults(urls);
}

async function runUrlFetch() {
  const url = document.getElementById('urlInput').value.trim();
  if (!url) { output.innerHTML = '<div class="text-warning">Enter a URL!</div>'; return; }
  try {
    let fetchUrl = url;
    if (document.getElementById('useProxy').checked) {
      fetchUrl = 'https://cors-anywhere.herokuapp.com/' + url;
    }
    const res = await fetch(fetchUrl);
    const html = await res.text();
    const urls = extractUrlsFromHtml(html);
    displayResults(urls);
  } catch(err) {
    output.innerHTML = '<div class="text-danger">Error fetching URL: ' + err + '</div>';
    console.error(err);
  }
}

runBtn.onclick = async () => {
  const url = document.getElementById('urlInput').value.trim();
  const manual = document.getElementById('htmlInput').value.trim();

  if(url) await runUrlFetch();
  else if(manual) await runManualHtml();
  else output.innerHTML = '<div class="text-warning">Enter a URL or paste HTML!</div>';
};
</script>

</body>
</html>
