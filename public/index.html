<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Readability Checker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 2rem; background: #f5f5f5; }
    .card { padding: 2rem; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .formula { 
      border: 2px solid #ddd; 
      border-radius: 8px; 
      padding: 1rem; 
      margin-bottom: 1rem; 
      background: white;
    }
    .formula h3 { font-size: 1.1rem; margin-bottom: 0.5rem; color: #333; }
    .score-box { 
      display: inline-block; 
      padding: 0.5rem 1rem; 
      border-radius: 4px; 
      margin: 0.5rem 0; 
      font-size: 1.1rem;
    }
    .calc { 
      margin-top: 0.5rem; 
      padding: 0.5rem; 
      background: #f8f9fa; 
      border-radius: 4px; 
      font-size: 0.9rem;
    }
  </style>
  <style>
    body { 
      padding: 2rem; 
      background: #f5f5f5; 
    }
  
    .card { 
      padding: 2rem; 
      background: white; 
      border-radius: 8px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    }
  
    .formula { 
      border: 2px solid #ddd; 
      border-radius: 8px; 
      padding: 1rem; 
      margin-bottom: 1rem; 
      background: white;
    }
  
    .formula h3 { 
      font-size: 1.1rem; 
      margin-bottom: 0.5rem; 
      color: #333; 
    }
  
    .score-box { 
      display: inline-block; 
      padding: 0.5rem 1rem; 
      border-radius: 4px; 
      margin: 0.5rem 0; 
      font-size: 1.1rem;
    }
  
    .calc { 
      margin-top: 0.5rem; 
      padding: 0.5rem; 
      background: #f8f9fa; 
      border-radius: 4px; 
      font-size: 0.9rem;
    }
  
    /* -------------------------
        MOBILE OPTIMIZATION
       ------------------------- */
    @media (max-width: 576px) {
  
      body {
        padding: 0.8rem !important;
      }
  
      .card {
        padding: 1rem !important;
        box-shadow: none !important;
      }
  
      textarea {
        font-size: 0.9rem !important;
        min-height: 130px;
      }
  
      h1 {
        font-size: 1.3rem !important;
        margin-bottom: 1rem !important;
      }
  
      .mb-3 {
        margin-bottom: 0.8rem !important;
      }
  
      .formula {
        padding: 0.7rem !important;
        margin-bottom: 0.8rem !important;
        border-width: 1px;
      }
  
      .formula h3 {
        font-size: 1rem !important;
        margin-bottom: 0.3rem !important;
      }
  
      .score-box {
        padding: 0.3rem 0.6rem !important;
        font-size: 0.9rem !important;
        margin: 0.3rem 0 !important;
      }
  
      #char-stats,
      #difficulty,
      #sentence-stats,
      #paragraph-stats,
      #word-stats,
      #syllable-stats {
        padding: 0.8rem !important;
        border-radius: 4px !important;
        font-size: 0.85rem !important;
      }
  
      #results .formula .calc {
        font-size: 0.8rem !important;
        padding: 0.4rem !important;
      }
  
      button.btn {
        padding: 0.35rem 0.75rem !important;
        font-size: 0.8rem !important;
      }
  
      .gap-2 {
        gap: 0.5rem !important;
      }
    }
  </style>  
</head>
<body>

<div class="card mx-auto" style="max-width:800px;">
  <h1 class="mb-3">Readability Checker</h1>

  <div class="mb-3">
    <textarea id="input" class="form-control" rows="6" placeholder="Paste your text here...">Learning to code is an essential skill in todays world. It allows people to create software automate tasks and solve complex problems efficiently. Beginners may feel overwhelmed at first but with consistent practice even challenging concepts become manageable. Programming languages vary in syntax and complexity yet the fundamental logic remains similar across most languages. Understanding algorithms data structures and design patterns is crucial for building reliable and scalable applications. Moreover coding fosters critical thinking problem solving and creativity. Online tutorials coding bootcamps and practice projects provide ample opportunities for learners to improve and gain confidence in their abilities.</textarea>
  </div>

  <div class="mb-3 d-flex gap-2">
    <button id="analyze" class="btn btn-primary">Analyze</button>
    <button id="clear" class="btn btn-secondary">Clear</button>
  </div>

  <div id="output" style="display:none;">
    <div id="char-stats" class="mb-3" style="background: #e3f2fd; padding: 1rem; border-radius: 4px;"></div>
    <div id="difficulty" class="mb-3" style="background: #fff3cd; padding: 1rem; border-radius: 4px; border: 2px solid #ffc107;"></div>
    <div id="sentence-stats" class="mb-3" style="background: #e8f5e9; padding: 1rem; border-radius: 4px;"></div>
    <div id="paragraph-stats" class="mb-3" style="background: #f3e5f5; padding: 1rem; border-radius: 4px;"></div>
    <div id="word-stats" class="mb-3" style="background: #fff8e1; padding: 1rem; border-radius: 4px;"></div>
    <div id="syllable-stats" class="mb-3" style="background: #fce4ec; padding: 1rem; border-radius: 4px;"></div>
    <div id="results" class="mb-3"></div>
  </div>
</div>

<script src="/scripts/extract.js"></script>
<script src="/scripts/formula.js"></script>
<script>
const oldReferenceData = {
  character: {
    totalWords: 98,
    avgWordLength: 6,
    longestWord: 'Understanding',
    longestWordLength: 13,
    charsWithSpaces: 720,
    charsWithoutSpaces: 623,
    lettersAZ: 616,
    alphaNumeric: 616
  },
  sentences: {
    total: 7,
    avgLength: 14,
    activeVoice: 7,
    passiveVoice: 0,
    short: 2,
    medium: 5,
    long: 0
  },
  paragraphs: {
    count: 1,
    shortest: 98,
    longest: 98
  },
  words: {
    easy: 72,
    hard: 26,
    unique: 75,
    repeat: 15
  },
  syllables: {
    total: 201,
    avgPerWord: 2.05,
    oneSyl: 35,
    twoSyl: 37,
    threeSyl: 14,
    fourSyl: 10,
    fiveSyl: 2,
    sixSyl: 0,
    sevenPlusSyl: 0
  },
  difficulty: {
    hardWords: 26,
    longSentences: 0,
    adverbs: 3,
    hardAdjectives: 9,
    nominals: 1,
    passiveWords: 0,
    weakVerbs: 2
  }
};

const referenceData = {
  difficulty: { // TEXT DIFFICULTY
    hardWords: 26,
    longSentences: 0,
    adverbs: 3,
    hardAdjectives: 9,
    nominals: 1,
    passiveWords: 0,
    weakVerbs: 2
  },
  character: { // Word/Character Stats
    totalWords: 98,
    avgWordLength: 6,
    longestWord: "Understanding",
    longestWordLength: 13,
    charsWithSpaces: 720,
    charsWithoutSpaces: 623,
    lettersAZ: 616,
    alphaNumeric: 616
  },
  sentences: { // Sentence Stats
    total: 7,
    lineCount: 0,
    totalLines: 7,
    avgLength: 14,
    activeVoice: 7,
    passiveVoice: 0,
    short: 2,
    medium: 5,
    long: 0
  },
  paragraphs: { // Paragraph Stats
    count: 1,
    shortest: 98,
    longest: 98
  },
  words: { // Word Stats
    easy: 72,
    hard: 26,
    compound: 0,
    cardinal: 0,
    properNoun: 0,
    abbreviated: 0,
    unique: 75,
    repeat: 15
  },
  syllables: { // Syllable Stats
    total: 201,
    avgPerWord: 2.05,
    oneSyl: 35,
    twoSyl: 37,
    threeSyl: 14,
    fourSyl: 10,
    fiveSyl: 2,
    sixSyl: 0,
    sevenPlusSyl: 0
  }
};


function compareValue(calculated, reference, tolerance = 0) {
  const match = Math.abs(calculated - reference) <= tolerance;
  const color = match ? '#4caf50' : '#f44336';
  const icon = match ? '✓' : '✗';
  return { match, color, icon };
}

function formatComparison(label, calculated, reference, unit = '', tolerance = 0) {
  const comp = compareValue(calculated, reference, tolerance);
  return `<div style="color: ${comp.color};">
    <strong>${label}:</strong> <b>${calculated}${unit}</b> 
    ${comp.icon} (Expected: ${reference}${unit})
  </div>`;
}

function categorizeSentences(sentences) {
  const short = sentences.filter(s => splitWords(s).length <= 10).length;
  const medium = sentences.filter(s => {
    const len = splitWords(s).length;
    return len > 10 && len < 20;
  }).length;
  const long = sentences.filter(s => splitWords(s).length >= 20).length;
  return { short, medium, long };
}

document.getElementById('analyze').addEventListener('click', () => {
  const text = document.getElementById('input').value.trim();
  if (!text) { alert('Please enter text'); return; }

  const normalized = normalizeText(text);
  const sentences = splitSentences(normalized);
  const words = splitWords(normalized);
  const letters = countLetters(normalized);
  const charsWithSpaces = countCharsWithSpaces(normalized);
  const charsWithoutSpaces = countCharsWithoutSpaces(normalized);
  const avgWordLength = getAverageWordLength(words);
  const longestWord = getLongestWord(words);
  
  const syllablesPerWord = words.map(w => syllablesInWord(w));
  const syllables = syllablesPerWord.reduce((sum, s) => sum + s, 0);
  const oneSyllable = syllablesPerWord.filter(s => s === 1).length;
  const twoSyllable = syllablesPerWord.filter(s => s === 2).length;
  const threeSyllable = syllablesPerWord.filter(s => s === 3).length;
  const fourSyllable = syllablesPerWord.filter(s => s === 4).length;
  const fiveSyllable = syllablesPerWord.filter(s => s === 5).length;
  const sixSyllable = syllablesPerWord.filter(s => s === 6).length;
  const sevenPlusSyllable = syllablesPerWord.filter(s => s >= 7).length;
  
  const complexWords = syllablesPerWord.filter(s => s >= 3).length;
  const easyWords = syllablesPerWord.filter(s => s < 3).length;
  const hardWords = syllablesPerWord.filter(s => s >= 3).length;

  const adverbs = countAdverbs(words);
  const longSentences = countLongSentences(sentences);
  const hardAdjectives = countHardAdjectives(words);
  const nominals = countNominalizations(words);
  const passiveWords = countPassiveVoice(normalized);
  const weakVerbs = countWeakVerbs(words);
  
  const sentenceCategories = categorizeSentences(sentences);
  const avgSentenceLength = Math.round(words.length / sentences.length);
  const uniqueWordStats = countUniqueWords(words);

  const data = {
    letters,
    wordsCount: words.length,
    sentencesCount: sentences.length,
    syllables,
    oneSyllable,
    complexWords,
    easyWords,
    hardWords
  };

  const results = [
    calculateFK(data),
    calculateARI(data),
    calculateCLI(data),
    calculateGFI(data),
    calculateSMOG(data),
    calculateLinsearWrite(data),
    calculateFORCAST(data),
    calculateFlesch(data)
  ];

  const consensus = calculateAverageGrade(results);
  results.unshift(consensus);

  document.getElementById('output').style.display = 'block';

  document.getElementById('char-stats').innerHTML = `
    <strong style="font-size: 1.1rem;">WORD/CHARACTER STATS</strong><br><br>
    ${formatComparison('Total # of words', data.wordsCount, referenceData.character.totalWords)}
    ${formatComparison('Average word length', Math.round(avgWordLength), referenceData.character.avgWordLength, ' characters')}
    <div style="color: ${longestWord.word === referenceData.character.longestWord ? '#4caf50' : '#f44336'};">
      <strong>Longest word in text:</strong> <b>${longestWord.word}</b> (${longestWord.length} characters)
      ${longestWord.word === referenceData.character.longestWord ? '✓' : '✗'} (Expected: ${referenceData.character.longestWord} (${referenceData.character.longestWordLength} characters))
    </div>
    ${formatComparison('Character Count (including whitespace)', charsWithSpaces, referenceData.character.charsWithSpaces, ' chars')}
    ${formatComparison('Character Count (excluding whitespace)', charsWithoutSpaces, referenceData.character.charsWithoutSpaces, ' chars')}
    ${formatComparison('Total # of letter characters (A-Z only)', letters, referenceData.character.lettersAZ, ' chars')}
    ${formatComparison('Alpha-Number Character Count', letters, referenceData.character.alphaNumeric, ' chars')}
  `;

  document.getElementById('difficulty').innerHTML = `
    <strong style="font-size: 1.1rem;">TEXT DIFFICULTY</strong><br><br>
    ${formatComparison('Hard Words', hardWords, referenceData.difficulty.hardWords)}
    ${formatComparison('Long Sentences', longSentences, referenceData.difficulty.longSentences)}
    ${formatComparison('Adverbs', adverbs, referenceData.difficulty.adverbs)}
    ${formatComparison('Hard Adjectives', hardAdjectives, referenceData.difficulty.hardAdjectives)}
    ${formatComparison('Nominals', nominals, referenceData.difficulty.nominals)}
    ${formatComparison('Passive Words', passiveWords, referenceData.difficulty.passiveWords)}
    ${formatComparison('Weak Verbs', weakVerbs, referenceData.difficulty.weakVerbs)}
  `;
  
  document.getElementById('sentence-stats').innerHTML = `
    <strong style="font-size: 1.1rem;">SENTENCE STATS</strong><br><br>
    ${formatComparison('Total # of sentences', data.sentencesCount, referenceData.sentences.total)}
    ${formatComparison('Average Sentence Length', avgSentenceLength, referenceData.sentences.avgLength, ' words')}
    ${formatComparison('Number of Active Voice sentences', data.sentencesCount - passiveWords, referenceData.sentences.activeVoice)}
    ${formatComparison('Number of Passive Voice sentences', passiveWords, referenceData.sentences.passiveVoice)}
    ${formatComparison('Total # of short sentences', sentenceCategories.short, referenceData.sentences.short)}
    ${formatComparison('Total # of medium sentences', sentenceCategories.medium, referenceData.sentences.medium)}
    ${formatComparison('Total # of long sentences', sentenceCategories.long, referenceData.sentences.long)}
  `;
  
  document.getElementById('word-stats').innerHTML = `
    <strong style="font-size: 1.1rem;">WORD STATS</strong><br><br>
    ${formatComparison('# of Easy Words', easyWords, referenceData.words.easy)}
    ${formatComparison('# of Hard Words', hardWords, referenceData.words.hard)}
    ${formatComparison('Total # of unique words', uniqueWordStats.unique, referenceData.words.unique)}
    ${formatComparison('Total # of repeat words', uniqueWordStats.repeat, referenceData.words.repeat)}
  `;
  
  const avgSyllables = (syllables / data.wordsCount).toFixed(2);
  
  document.getElementById('syllable-stats').innerHTML = `
    <strong style="font-size: 1.1rem;">SYLLABLE STATS</strong><br><br>
    ${formatComparison('Total # of syllables in text', syllables, referenceData.syllables.total)}
    ${formatComparison('Average # of syllables per word', parseFloat(avgSyllables), referenceData.syllables.avgPerWord, '', 0.01)}
    ${formatComparison('Total # of words with 1 syllable', oneSyllable, referenceData.syllables.oneSyl)}
    ${formatComparison('Total # of words with 2 syllables', twoSyllable, referenceData.syllables.twoSyl)}
    ${formatComparison('Total # of words with 3 syllables', threeSyllable, referenceData.syllables.threeSyl)}
    ${formatComparison('Total # of words with 4 syllables', fourSyllable, referenceData.syllables.fourSyl)}
    ${formatComparison('Total # of words with 5 syllables', fiveSyllable, referenceData.syllables.fiveSyl)}
    ${formatComparison('Total # of words with 6 syllables', sixSyllable, referenceData.syllables.sixSyl)}
    ${formatComparison('Total # of words with 7+ syllables', sevenPlusSyllable, referenceData.syllables.sevenPlusSyl)}
  `;
  
  document.getElementById('paragraph-stats').innerHTML = `
    <strong style="font-size: 1.1rem;">PARAGRAPH STATS</strong><br><br>
    ${formatComparison('Number of paragraphs', 1, referenceData.paragraphs.count)}
    ${formatComparison('Shortest paragraph', data.wordsCount, referenceData.paragraphs.shortest, ' words')}
    ${formatComparison('Longest paragraph', data.wordsCount, referenceData.paragraphs.longest, ' words')}
  `;

  const output = document.getElementById('results');
  output.innerHTML = '';

  results.forEach(res => {
    const div = document.createElement('div');
    div.className = 'formula';
    if (res.name === "Consensus Grade Level") {
      div.style.borderColor = res.color;
      div.style.borderWidth = '3px';
    }
    div.innerHTML = `
      <h3>${res.name}</h3>
      <div class="score-box" style="background:${res.color};color:#fff;">
        Score: <b>${res.score.toFixed(2)}</b>
      </div>
      <div>Reading Difficulty: <b>${res.difficulty}</b></div>
      <div>Grade Level: <b>${res.grade}</b> | Age Range: <b>${res.age}</b></div>
      <div class="calc">${res.formulaHTML}</div>
    `;
    output.appendChild(div);
  });
});

document.getElementById('clear').addEventListener('click', () => {
  document.getElementById('input').value = '';
  document.getElementById('output').style.display = 'none';
});
</script>
</body>
</html>