<div class="p-sm-3">
  <h1 class="mb-2 mb-sm-3 fs-5 fs-sm-3">Readability Checker</h1>

  <div class="mb-2 mb-sm-3">
    <textarea id="input" class="form-control form-control-sm" rows="6" placeholder="Paste your text here...">Learning to code is an essential skill in todays world. It allows people to create software automate tasks and solve complex problems efficiently. Beginners may feel overwhelmed at first but with consistent practice even challenging concepts become manageable. Programming languages vary in syntax and complexity yet the fundamental logic remains similar across most languages. Understanding algorithms data structures and design patterns is crucial for building reliable and scalable applications. Moreover coding fosters critical thinking problem solving and creativity. Online tutorials coding bootcamps and practice projects provide ample opportunities for learners to improve and gain confidence in their abilities.</textarea>
  </div>

  <div class="mb-2 mb-sm-3 d-flex gap-2">
    <button id="analyze" class="btn btn-primary btn-sm">Analyze</button>
    <button id="clear" class="btn btn-secondary btn-sm">Clear</button>
  </div>

  <div id="output" class="row d-none small">
    <div id="char-stats" class="col-md-12 mb-2 mb-sm-3 p-2 p-sm-3 bg-info-subtle rounded"></div>
    <div id="difficulty" class="col-md-12 mb-2 mb-sm-3 p-2 p-sm-3 bg-warning-subtle rounded border border-warning border-2"></div>
    <div id="sentence-stats" class="col-md-12 mb-2 mb-sm-3 p-2 p-sm-3 bg-success-subtle rounded"></div>
    <div id="paragraph-stats" class="col-md-12 mb-2 mb-sm-3 p-2 p-sm-3 bg-body-secondary rounded"></div>
    <div id="word-stats" class="col-md-12 mb-2 mb-sm-3 p-2 p-sm-3 bg-warning-subtle rounded"></div>
    <div id="syllable-stats" class="col-md-12 mb-2 mb-sm-3 p-2 p-sm-3 bg-warning-subtle rounded"></div>
    
  </div>
  <div id="results" class="row mb-2 mb-sm-3"></div>
</div>
</div>

<script src="/scripts/extract.js"></script>
<script src="/scripts/formula.js"></script>
<script>
const expectedResults = {
'Consensus Grade Level': 14.89,
'Automated Readability Index': 15.51,
'Flesch Reading Ease': 20.00,
'Gunning Fog Index': 16.20,
'Flesch-Kincaid Grade Level': 14.07,
'Coleman-Liau Index': 19.05,
'SMOG Index': 11.16,
'Linsear Write': 10.50,
'FORCAST': 14.64
};
const referenceData = {
difficulty: {
hardWords: 26,
longSentences: 0,
adverbs: 3,
hardAdjectives: 9,
nominals: 1,
passiveWords: 0,
weakVerbs: 2
},
character: {
totalWords: 98,
avgWordLength: 6,
longestWord: "Understanding",
longestWordLength: 13,
charsWithSpaces: 720,
charsWithoutSpaces: 623,
lettersAZ: 616,
alphaNumeric: 616
},
sentences: {
total: 7,
lineCount: 0,
totalLines: 7,
avgLength: 14,
activeVoice: 7,
passiveVoice: 0,
short: 2,
medium: 5,
long: 0
},
paragraphs: {
count: 1,
shortest: 98,
longest: 98
},
words: {
easy: 72,
hard: 26,
compound: 0,
cardinal: 0,
properNoun: 0,
abbreviated: 0,
unique: 75,
repeat: 15
},
syllables: {
total: 201,
avgPerWord: 2.05,
oneSyl: 35,
twoSyl: 37,
threeSyl: 14,
fourSyl: 10,
fiveSyl: 2,
sixSyl: 0,
sevenPlusSyl: 0
}
};

document.getElementById('analyze').addEventListener('click', () => {
const text = document.getElementById('input').value.trim();
if (!text) { alert('Please enter text'); return; }

const data = analyzeText(text);
console.log(referenceData);
console.log(data);

const results = [
calculateARI(referenceData),
calculateFlesch(referenceData),
calculateGFI(referenceData),
calculateFK(referenceData),
calculateCLI(referenceData),
calculateSMOG(referenceData),
calculateLinsearWrite(referenceData),
calculateFORCAST(referenceData)
];

const consensus = calculateAverageGrade(results);
results.unshift(consensus);

showStats(data)

const output = document.getElementById('results');
output.innerHTML = '';

results.forEach(res => {
console.log(res);
const expectedScore = expectedResults[res.name];
let matchHTML = '';

if (expectedScore !== undefined) {
  const comp = compareValue(res.score, expectedScore, 0.01);
  matchHTML = `<div style="color: ${comp.color}; margin-top: 8px;">
    Formula Result: <b>${res.score.toFixed(2)}</b> ${comp.icon} Expected: <b>${expectedScore.toFixed(2)}</b>
  </div>`;
}

const div = document.createElement('div');
div.className = 'col-md-12 bg-body-secondary border rounded p-3 mb-3';
if (res.name === "Consensus Grade Level") {
  div.className += ' formula';
  div.style.borderColor = res.color;
  div.style.borderWidth = '3px';
} else {
  div.style.borderColor = res.color;
  div.style.borderWidth = '2px';
}
div.innerHTML = formatResult(res, matchHTML);
output.appendChild(div);
});
});
function formatResult(res, matchHTML='') {
return `
<h3 class="fs-6 mb-2 text-center"><b>${res.name}</b></h3>
<div class="score-box px-3 py-2 rounded mb-2 fs-6">
<div>Score: <b style="color:${res.color};">${res.score.toFixed(2)}</b></div>
<div>Reading Difficulty: <b style="color:${res.color};">${res.difficulty}</b></div>
<div>Grade Level: <b style="color:${res.color};">${res.grade}</b> | Age Range: <b>${res.age}</b></div>
<div>${res.formulaHTML}</div>
</div>
${matchHTML}
`;
}
</script>
